# ============================================================================
# platformio.ini - SECURE BOOTLOADER
# ============================================================================
# Projet: stm32_secure_bootloader
# Flash: 0x08000000 - 0x08001FFF (8KB)
# ============================================================================

[env:bootloader]
platform = ststm32
board = genericSTM32F103C8
framework = stm32cube
upload_protocol = stlink
debug_tool = stlink
monitor_speed = 115200

# ⚠️ IMPORTANT: Linker script personnalisé pour bootloader
board_build.ldscript = STM32F103C8Tx_FLASH_BOOTLOADER.ld

# Options de build
build_flags = 
    -DSTM32F103xB
    -DUSE_HAL_DRIVER
    -DHSE_VALUE=8000000
    -Os                     ; Optimisation taille
    -Wall                   ; Tous les warnings
    -Wextra
    -g                      ; Symboles de debug

# Répertoires include
build_src_filter = 
    +<*>
    +<../lib/crypto/*>      ; Bibliothèque crypto

# Upload configuration
upload_flags = 
    --reset                 ; Reset après flash

# Debug configuration
debug_build_flags = -Og -g -ggdb3

# Monitor configuration
monitor_filters = 
    default
    time